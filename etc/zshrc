NIX_PROFILE=$HOME/.nix-profile

# Powerline
POWERLINE_MODUES="venv,user,ssh,cwd,nix-shell,perms,git,jobs,exit,root"
POWERLINE_PRIORITY="root,user,host,ssh,perms,git-branch,git-status,cwd,hg,jobs,exit,cwd-path"

function powerline_precmd() {
  PS1="$($NIX_PROFILE/bin/powerline-go -jobs ${${(%):%j}:-0} -modules $POWERLINE_MODUES -priority $POWERLINE_PRIORITY -cwd-mode dironly -max-width 60)"
}

function install_powerline_precmd() {
  for s in "${precmd_functions[@]}"; do
    if [ "$s" = "powerline_precmd" ]; then
      return
    fi
  done
  precmd_functions+=(powerline_precmd)
}

if [ "$TERM" != "linux" ] && [ -f "$NIX_PROFILE/bin/powerline-go" ]; then
    install_powerline_precmd
fi

# Bat
export BAT_THEME="Solarized (dark)"

# Restore Key Binding
bindkey -e

# Zsh Extension
[ -f $NIX_PROFILE/share/zsh-autosuggestions/zsh-autosuggestions.zsh ] && source $NIX_PROFILE/share/zsh-autosuggestions/zsh-autosuggestions.zsh
ZSH_AUTOSUGGEST_HIGHLIGHT_STYLE="fg=10"
ZSH_AUTOSUGGEST_STRATEGY=(history completion)

# Development
[ $(command -v rbenv) ] && eval "$(rbenv init -)"

# Nix
[ -f $NIX_PROFILE/share/nix-direnv/direnvrc ] && source $NIX_PROFILE/share/nix-direnv/direnvrc
[ -f $NIX_PROFILE/bin/direnv ] && eval "$(direnv hook zsh)"

# Auto Complection
fpath=($NIX_PROFILE/share/zsh/site-functions $fpath)
[ -f $NIX_PROFILE/share/git/contrib/completion/git-completion.zsh ] && zstyle ':completion:*:*:git:*' script $NIX_PROFILE/share/git/contrib/completion/git-completion.zsh

autoload -Uz compinit && compinit
